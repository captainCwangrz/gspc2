@media (max-width: 768px) {
    /* --- CRITICAL FIX: NUKE ALL DESKTOP LAYERS --- */
    /* Hide all desktop HUDs to prevent them from blocking clicks */
    #ui-layer, 
    #sidebar, 
    #inspector-panel, 
    #connection-panel,
    #profile-hud, 
    #search-hud, 
    #notif-hud, 
    #chat-hud,
    .hud-panel { 
        display: none !important; 
        visibility: hidden !important;
        pointer-events: none !important;
    }

    /* --- MOBILE APP SHELL --- */
    #mobile-shell {
        display: block !important;
        width: 100%;
        height: 100vh; /* Fallback */
        height: 100dvh; /* Modern mobile height */
        position: fixed;
        inset: 0;
        pointer-events: none; /* Let clicks pass through to 3D canvas */
        z-index: 9999;
    }
    
    /* Re-enable clicks on specific mobile UI elements */
    #mobile-shell > *,
    #mobile-top-bar,
    #mobile-nav,
    .sheet,
    .fs-view,
    .backdrop { 
        pointer-events: auto; 
    }

    /* --- GLOBAL RESET FOR MOBILE --- */
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        overflow: hidden; /* Prevent elastic scrolling on body */
        background: #020617; /* Dark theme base */
        color: #fff;
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        -webkit-tap-highlight-color: transparent;
    }

    /* --- LOGIN PAGE FIXES (.login-body) --- */
    body.login-body {
        overflow-y: auto !important; /* Allow scroll on login */
        background: linear-gradient(135deg, #0f172a 0%, #020617 100%);
    }

    .login-body .login-container {
        width: 90% !important;
        max-width: none !important;
        margin: 40px auto !important;
        padding: 20px !important;
        box-sizing: border-box;
    }

    .login-body .login-header h1 {
        font-size: 2rem !important;
        margin-bottom: 10px !important;
    }
    
    .login-body .login-header p {
        font-size: 1rem !important;
        opacity: 0.8;
    }

    .login-body .login-box {
        padding: 20px !important;
        border-radius: 16px !important;
        background: rgba(30, 41, 59, 0.5) !important;
        backdrop-filter: blur(10px);
    }

    /* --- COMPONENT STYLES --- */
    #mobile-top-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 50px;
        padding: 0 16px;
        padding-top: env(safe-area-inset-top);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: linear-gradient(to bottom, rgba(2,6,23,0.9), rgba(2,6,23,0));
        z-index: 100;
        pointer-events: none; /* Let user drag map under the header */
    }
    #mobile-top-bar > * { pointer-events: auto; }

    #mobile-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255,255,255,0.1);
        padding-bottom: env(safe-area-inset-bottom);
        height: 60px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 100;
    }
    
    .nav-item {
        background: transparent;
        border: none;
        color: #94a3b8;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        font-size: 12px;
        padding: 8px 16px;
    }
    
    .nav-item.active { color: #a855f7; }
    .nav-item .icon { font-size: 20px; display: block; }

    /* Bottom Sheet */
    .sheet {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: #1e293b;
        border-radius: 20px 20px 0 0;
        padding: 20px;
        padding-bottom: calc(20px + env(safe-area-inset-bottom));
        transform: translateY(110%);
        transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        z-index: 200;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
    }
    .sheet.visible { transform: translateY(0); }
    
    .backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
        z-index: 150;
    }
    .backdrop.visible { opacity: 1; pointer-events: auto; }

    /* Fullscreen Views (Chat/Search) */
    .fs-view {
        position: fixed;
        inset: 0;
        background: #020617;
        z-index: 300;
        display: flex;
        flex-direction: column;
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
    }
    .fs-view.hidden { display: none !important; }
    
    .fs-header {
        height: 50px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        display: flex;
        align-items: center;
        padding: 0 16px;
        gap: 12px;
    }
    
    #mobile-chat-list { flex: 1; overflow-y: auto; padding: 16px; }
    .fs-footer { padding: 10px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 8px; }
    
    input[type="text"] {
        background: #334155;
        border: 1px solid #475569;
        color: white;
        border-radius: 99px;
        padding: 10px 16px;
        width: 100%;
        box-sizing: border-box;
    }
    
    button { cursor: pointer; }
}
